<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Customizable Dashboard</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    margin: 0; 
    padding: 0; 
    display: flex; 
    flex-direction: column;
    height: 100vh;
  }

  header, footer {
    background: #333;
    color: #fff;
    padding: 10px 20px;
  }

  header h1 {
    margin: 0;
    display: inline-block;
  }

  #config-button {
    float: right;
    background: #444;
    border: none;
    color: #fff;
    padding: 5px 10px;
    cursor: pointer;
  }

  #dashboard {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    padding: 20px;
    overflow-y: auto;
  }

  .tile {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    padding: 20px;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
  }
  .tile h2 {
    margin: 0 0 10px;
    font-size: 1.2em;
    text-align: center;
  }
  .tile p {
    margin: 5px 0;
    text-align: center;
  }
  .updated {
    font-size: 0.8em;
    color: #999;
    margin-top: 10px;
  }

  footer p {
    margin: 0;
  }

  /* Config Panel (modal) */
  #config-panel-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right:0;
    bottom:0;
    background: rgba(0,0,0,0.5);
    display: none;
    align-items:center;
    justify-content:center;
    z-index: 9999;
  }
  #config-panel {
    background: #fff;
    border-radius: 8px;
    width: 90%;
    max-width: 600px;
    padding: 20px;
    position: relative;
    max-height: 90vh;
    overflow-y: auto;
  }
  #config-panel h2 {
    margin-top: 0;
  }
  #config-close {
    position:absolute;
    top:10px;
    right:10px;
    background:none;
    border:none;
    font-size:1.2em;
    cursor:pointer;
  }
  .tile-config {
    margin-bottom:20px;
    border-bottom:1px solid #ccc;
    padding-bottom:10px;
  }
  .tile-config:last-child {
    border-bottom:none;
  }
  .tile-config h3 {
    margin:0 0 10px;
  }
  .tile-config label {
    display:block;
    font-size:0.9em;
    margin:5px 0 3px;
  }
  .tile-config input[type="text"], 
  .tile-config input[type="number"], 
  .tile-config select, 
  .tile-config textarea {
    width:100%;
    margin-bottom:5px;
    box-sizing: border-box;
  }
  #save-config {
    background: #333;
    color:#fff;
    padding:10px 20px;
    border:none;
    cursor:pointer;
    float:right;
    margin-top: 20px;
  }
</style>
</head>
<body>

<header>
  <h1>My Custom Dashboard</h1>
  <button id="config-button">Configure</button>
</header>

<div id="dashboard"></div>

<footer>
  <p>&copy; 2024 My Dashboard</p>
</footer>

<div id="config-panel-overlay">
  <div id="config-panel">
    <button id="config-close">&times;</button>
    <h2>Dashboard Configuration</h2>
    <form id="config-form"></form>
    <button id="save-config">Save</button>
  </div>
</div>

<script>
  // ========== Initial Tiles Config ==========
  // Added a variety of tiles to the "library"
  // Some are visible by default, others are not. 
  let tilesConfig = {
    tiles: [
      {
        id: "weather-1",
        type: "weather",
        visible: true,
        config: {
          city: "New York",
          countryCode: "US",
          apiKey: "YOUR_OPENWEATHER_API_KEY"
        }
      },
      {
        id: "stock-1",
        type: "stock",
        visible: true,
        config: {
          symbol: "AAPL",
          apiKey: "YOUR_FINNHUB_API_KEY"
        }
      },
      {
        id: "rss-1",
        type: "rss",
        visible: false,
        config: {
          url: "https://api.rss2json.com/v1/api.json?rss_url=https://news.google.com/rss",
          limit: 5
        }
      },
      {
        id: "quote-1",
        type: "quote",
        visible: false,
        config: {
          // no special config needed, but we could add a refresh interval if desired
        }
      },
      {
        id: "crypto-1",
        type: "crypto",
        visible: false,
        config: {
          coinId: "bitcoin",
          currency: "usd"
        }
      },
      {
        id: "notes-1",
        type: "notes",
        visible: false,
        config: {
          text: "Enter your notes here..."
        }
      },
      {
        id: "clock-1",
        type: "clock",
        visible: false,
        config: {
          format: "24h" // or "12h"
        }
      }
    ]
  };

  // Load from localStorage if available
  const savedConfig = localStorage.getItem("dashboardConfig");
  if (savedConfig) {
    tilesConfig = JSON.parse(savedConfig);
  }

  const dashboard = document.getElementById("dashboard");

  // ========== Data Fetch Functions ==========

  async function fetchWeather(tile) {
    const {city, countryCode, apiKey} = tile.config;
    const url = `https://api.openweathermap.org/data/2.5/weather?q=${city},${countryCode}&units=metric&appid=${apiKey}`;
    const response = await fetch(url);
    if (!response.ok) throw new Error("Weather fetch error");
    return await response.json();
  }

  async function fetchStock(tile) {
    const {symbol, apiKey} = tile.config;
    const url = `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`;
    const response = await fetch(url);
    if (!response.ok) throw new Error("Stock fetch error");
    return await response.json();
  }

  async function fetchRSS(tile) {
    const {url, limit} = tile.config;
    const response = await fetch(url);
    if (!response.ok) throw new Error("RSS fetch error");
    const data = await response.json();
    // data.items should contain articles. We'll just slice by 'limit'
    return data.items.slice(0, limit);
  }

  async function fetchQuote(tile) {
    const url = "https://api.quotable.io/random";
    const response = await fetch(url);
    if (!response.ok) throw new Error("Quote fetch error");
    return await response.json();
  }

  async function fetchCrypto(tile) {
    const {coinId, currency} = tile.config;
    const url = `https://api.coingecko.com/api/v3/simple/price?ids=${coinId}&vs_currencies=${currency}`;
    const response = await fetch(url);
    if (!response.ok) throw new Error("Crypto fetch error");
    return await response.json();
  }

  // Clock tile doesn’t need fetch data, just shows current time

  // ========== Render Tiles ==========
  async function renderTiles() {
    dashboard.innerHTML = '';
    for (let tile of tilesConfig.tiles) {
      if (!tile.visible) continue;
      const tileEl = document.createElement("div");
      tileEl.className = "tile";

      try {
        if (tile.type === "weather") {
          tileEl.innerHTML = `<h2>Weather</h2><p>Loading...</p>`;
          const data = await fetchWeather(tile);
          tileEl.innerHTML = `
            <h2>Weather</h2>
            <p><strong>${data.name}, ${data.sys.country}</strong></p>
            <p>${Math.round(data.main.temp)} °C, ${data.weather[0].description}</p>
            <div class="updated">Updated: ${new Date().toLocaleTimeString()}</div>
          `;

        } else if (tile.type === "stock") {
          tileEl.innerHTML = `<h2>Stock: ${tile.config.symbol}</h2><p>Loading...</p>`;
          const data = await fetchStock(tile);
          tileEl.innerHTML = `
            <h2>Stock: ${tile.config.symbol}</h2>
            <p>Price: $${data.c.toFixed(2)}</p>
            <div class="updated">Updated: ${new Date().toLocaleTimeString()}</div>
          `;

        } else if (tile.type === "rss") {
          tileEl.innerHTML = `<h2>News</h2><p>Loading...</p>`;
          const articles = await fetchRSS(tile);
          let html = `<h2>News</h2>`;
          articles.forEach(a => {
            html += `<p><a href="${a.link}" target="_blank">${a.title}</a></p>`;
          });
          html += `<div class="updated">Updated: ${new Date().toLocaleTimeString()}</div>`;
          tileEl.innerHTML = html;

        } else if (tile.type === "quote") {
          tileEl.innerHTML = `<h2>Quote</h2><p>Loading...</p>`;
          const data = await fetchQuote(tile);
          tileEl.innerHTML = `
            <h2>Quote</h2>
            <p>"${data.content}"<br>- ${data.author}</p>
            <div class="updated">Updated: ${new Date().toLocaleTimeString()}</div>
          `;

        } else if (tile.type === "crypto") {
          tileEl.innerHTML = `<h2>Crypto: ${tile.config.coinId}</h2><p>Loading...</p>`;
          const data = await fetchCrypto(tile);
          const price = data[tile.config.coinId][tile.config.currency];
          tileEl.innerHTML = `
            <h2>${tile.config.coinId.charAt(0).toUpperCase() + tile.config.coinId.slice(1)} Price</h2>
            <p>${price} ${tile.config.currency.toUpperCase()}</p>
            <div class="updated">Updated: ${new Date().toLocaleTimeString()}</div>
          `;

        } else if (tile.type === "notes") {
          tileEl.innerHTML = `
            <h2>Notes</h2>
            <p>${tile.config.text.replace(/\n/g, "<br>")}</p>
          `;

        } else if (tile.type === "clock") {
          tileEl.innerHTML = `<h2>Clock</h2><p id="clock-${tile.id}">Loading...</p>`;
          updateClock(tile, tileEl.querySelector(`#clock-${tile.id}`));
          setInterval(() => updateClock(tile, tileEl.querySelector(`#clock-${tile.id}`)), 1000);

        } else {
          tileEl.innerHTML = `<h2>Unknown Tile</h2>`;
        }
      } catch (err) {
        tileEl.innerHTML += `<p>Error loading data</p>`;
        console.error(err);
      }

      dashboard.appendChild(tileEl);
    }
  }

  function updateClock(tile, el) {
    const now = new Date();
    let hours = now.getHours();
    let minutes = now.getMinutes().toString().padStart(2, '0');
    let seconds = now.getSeconds().toString().padStart(2, '0');

    if (tile.config.format === "12h") {
      const ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12 || 12;
      el.textContent = `${hours}:${minutes}:${seconds} ${ampm}`;
    } else {
      el.textContent = `${hours.toString().padStart(2, '0')}:${minutes}:${seconds}`;
    }
  }

  // ========== Configuration Panel ==========
  const configOverlay = document.getElementById("config-panel-overlay");
  const configButton = document.getElementById("config-button");
  const configClose = document.getElementById("config-close");
  const configForm = document.getElementById("config-form");
  const saveConfigButton = document.getElementById("save-config");

  function openConfigPanel() {
    configForm.innerHTML = '';
    tilesConfig.tiles.forEach(tile => {
      const tileDiv = document.createElement("div");
      tileDiv.className = "tile-config";

      tileDiv.innerHTML = `<h3>${tile.type.charAt(0).toUpperCase() + tile.type.slice(1)} Tile</h3>
        <label><input type="checkbox" name="visible-${tile.id}" ${tile.visible ? 'checked' : ''}> Visible</label>`;

      // Add fields depending on tile type
      if (tile.type === "weather") {
        tileDiv.innerHTML += `
          <label>City:</label>
          <input type="text" name="city-${tile.id}" value="${tile.config.city}">
          <label>Country Code:</label>
          <input type="text" name="country-${tile.id}" value="${tile.config.countryCode}">
          <label>API Key:</label>
          <input type="text" name="weatherKey-${tile.id}" value="${tile.config.apiKey}">
        `;
      } else if (tile.type === "stock") {
        tileDiv.innerHTML += `
          <label>Symbol:</label>
          <input type="text" name="symbol-${tile.id}" value="${tile.config.symbol}">
          <label>API Key:</label>
          <input type="text" name="stockKey-${tile.id}" value="${tile.config.apiKey}">
        `;
      } else if (tile.type === "rss") {
        tileDiv.innerHTML += `
          <label>RSS URL (JSON):</label>
          <input type="text" name="rssUrl-${tile.id}" value="${tile.config.url}">
          <label>Limit:</label>
          <input type="number" name="rssLimit-${tile.id}" value="${tile.config.limit}">
        `;
      } else if (tile.type === "quote") {
        // No extra config necessary, but we could add refresh interval if desired
        tileDiv.innerHTML += `<p>No additional config needed.</p>`;
      } else if (tile.type === "crypto") {
        tileDiv.innerHTML += `
          <label>Coin ID (e.g., bitcoin):</label>
          <input type="text" name="coinId-${tile.id}" value="${tile.config.coinId}">
          <label>Currency (e.g., usd):</label>
          <input type="text" name="currency-${tile.id}" value="${tile.config.currency}">
        `;
      } else if (tile.type === "notes") {
        tileDiv.innerHTML += `
          <label>Notes:</label>
          <textarea name="notesText-${tile.id}" rows="5">${tile.config.text}</textarea>
        `;
      } else if (tile.type === "clock") {
        tileDiv.innerHTML += `
          <label>Format:</label>
          <select name="clockFormat-${tile.id}">
            <option value="24h" ${tile.config.format === "24h" ? 'selected' : ''}>24-hour</option>
            <option value="12h" ${tile.config.format === "12h" ? 'selected' : ''}>12-hour</option>
          </select>
        `;
      }

      configForm.appendChild(tileDiv);
    });

    configOverlay.style.display = "flex";
  }

  function closeConfigPanel() {
    configOverlay.style.display = "none";
  }

  function saveConfig() {
    // Read form values and update tilesConfig
    tilesConfig.tiles = tilesConfig.tiles.map(tile => {
      const form = new FormData(configForm.closest('form') || configForm);
      const visible = form.get(`visible-${tile.id}`) !== null;
      tile.visible = visible;

      if (tile.type === "weather") {
        tile.config.city = form.get(`city-${tile.id}`);
        tile.config.countryCode = form.get(`country-${tile.id}`);
        tile.config.apiKey = form.get(`weatherKey-${tile.id}`);
      } else if (tile.type === "stock") {
        tile.config.symbol = form.get(`symbol-${tile.id}`);
        tile.config.apiKey = form.get(`stockKey-${tile.id}`);
      } else if (tile.type === "rss") {
        tile.config.url = form.get(`rssUrl-${tile.id}`);
        tile.config.limit = parseInt(form.get(`rssLimit-${tile.id}`), 10);
      } else if (tile.type === "crypto") {
        tile.config.coinId = form.get(`coinId-${tile.id}`);
        tile.config.currency = form.get(`currency-${tile.id}`);
      } else if (tile.type === "notes") {
        tile.config.text = form.get(`notesText-${tile.id}`);
      } else if (tile.type === "clock") {
        tile.config.format = form.get(`clockFormat-${tile.id}`);
      }

      return tile;
    });

    // Save to localStorage
    localStorage.setItem("dashboardConfig", JSON.stringify(tilesConfig));
    closeConfigPanel();
    renderTiles();
  }

  configButton.addEventListener("click", openConfigPanel);
  configClose.addEventListener("click", closeConfigPanel);
  saveConfigButton.addEventListener("click", saveConfig);

  // Initial render
  renderTiles();

  // Optional: Refresh all tiles every 5 minutes (for tiles like weather, stocks, RSS, quote, crypto)
  setInterval(renderTiles, 5 * 60 * 1000);
</script>

</body>
</html>